<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="page-title">EchoVision</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../public/css/download.css" />
    <style>
      .hidden {
        display: none !important;
      }

      .dashboard-btn,
      .nav-start-now-btn {
        background-color: #ff9800;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: bold;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease-in-out;
        border: none;
        cursor: pointer;
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2);
        margin-right: 10px;
      }
      .dashboard-btn:hover,
      .nav-start-now-btn:hover {
        background-color: #e68900;
        transform: scale(1.05);
      }
      .dashboard-btn:active,
      .nav-start-now-btn:active {
        transform: scale(0.95);
      }
    </style>
  </head>
  <body>
    <div class="landing-page">
      <header class="header">
        <img
          src="https://cdn.builder.io/api/v1/image/assets/TEMP/f323aebef58277caab7dbe39260b9674dd4a09ac63495998aff7e633a7743b82"
          alt="EchoVision Logo"
          class="logo"
        />
        <nav class="nav-container">
          <ul class="nav-links">
            <li>
              <a href="../index.html" class="nav-link" data-translate="nav-home"
                >Home</a
              >
            </li>
            <li>
              <a
                href="../pricing/pricing.html"
                class="nav-link"
                data-translate="nav-pricing"
                >Pricing</a
              >
            </li>
            <li>
              <a
                href="../about_us/about.html"
                class="nav-link"
                data-translate="nav-about"
                >About Us</a
              >
            </li>
            <li>
              <a
                href="../download/download.html"
                class="nav-link"
                data-translate="nav-download"
                >Download</a
              >
            </li>
            <!-- Start Now nav button (visible only when logged in and subscribed) -->
            <li id="start-now-li" class="hidden">
              <a
                href="../camera/camera.html"
                id="start-now-navbar-btn"
                class="nav-start-now-btn"
                data-translate="start-now"
                >Start Now</a
              >
            </li>
          </ul>
          <div class="auth-buttons">
            <a
              href="../auth/login.html"
              class="login-btn"
              id="login-btn"
              data-translate="login-btn"
              style="display: none"
              >Login</a
            >
            <a
              href="../auth/logout.html"
              class="logout-btn hidden"
              id="logout-btn"
              data-translate="logout-btn"
              >Logout</a
            >
            <a
              href="../auth/signup.html"
              class="signup-btn"
              id="signup-btn"
              data-translate="signup-btn"
              style="display: none"
              >Signup</a
            >
            <button id="lang-toggle" class="lang-btn" data-translate="lang-btn">
              AR
            </button>
            <a
              href="../../EchoVision-Frontend-Web-Dashboard/index.html"
              class="dashboard-btn hidden"
              id="dashboard-btn"
              data-translate="dashboard-btn"
            >
              <i class="ti ti-layout-dashboard"></i>
              <span>Dashboard</span>
            </a>
          </div>
        </nav>
      </header>

      <h1 class="main-heading" data-translate="main-heading">
        DOWNLOAD EchoVision
      </h1>

      <img
        src="https://cdn.builder.io/api/v1/image/assets/TEMP/249d4f3308aa75934ce6658fccb4a4a664df9cc52fac96f4b9d9e35afe762b19"
        alt="EchoVision App"
        class="app-image"
      />

      <section class="feature-section">
        <a href="#" class="feature-box">
          <div class="icon-container">
            <img
              src="https://cdn.builder.io/api/v1/image/assets/TEMP/ef1ba466c8dce1b4a20b734eda025c343685be67dcde405261fc2744248afeae"
              alt="Feature Icon"
              class="feature-icon"
            />
          </div>
        </a>
        <a href="#" class="feature-box-secondary">
          <div class="icon-container">
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/6/64/Android_logo_2019_%28stacked%29.svg"
              alt="Android Icon"
              class="feature-icon"
            />
          </div>
        </a>
      </section>

      <footer class="main-footer">
        <p data-translate="footer-text">
          © 2025, EchoVision, Inc. All Rights Reserved.
        </p>
      </footer>
    </div>

    <script>
      const translations = {
        en: {
          "page-title": "EchoVision",
          "main-heading": "DOWNLOAD EchoVision",
          "nav-home": "Home",
          "nav-pricing": "Pricing",
          "nav-about": "About Us",
          "nav-download": "Download",
          "login-btn": "Login",
          "signup-btn": "Signup",
          "logout-btn": "Logout",
          "dashboard-btn": "Dashboard",
          "lang-btn": "AR",
          "start-now": "Start Now",
          "footer-text": "© 2025, EchoVision, Inc. All Rights Reserved.",
        },
        ar: {
          "page-title": "إيكو ڤيجن",
          "main-heading": "تحميل EchoVision",
          "nav-home": "الرئيسية",
          "nav-pricing": "الأسعار",
          "nav-about": "حولنا",
          "nav-download": "تحميل",
          "login-btn": "تسجيل الدخول",
          "signup-btn": "إنشاء حساب",
          "logout-btn": "تسجيل الخروج",
          "dashboard-btn": "لوحة التحكم",
          "lang-btn": "EN",
          "start-now": "ابدأ الآن",
          "footer-text": "© 2025، EchoVision، Inc. جميع الحقوق محفوظة.",
        },
      };

      function updateLanguage(lang) {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";
        document.getElementById("lang-toggle").textContent =
          translations[lang]["lang-btn"];

        document.querySelectorAll("[data-translate]").forEach((el) => {
          const key = el.getAttribute("data-translate");
          if (translations[lang][key]) {
            el.textContent = translations[lang][key];
          }
        });

        document.body.style.direction = lang === "ar" ? "rtl" : "ltr";
        document.body.style.textAlign = lang === "ar" ? "right" : "left";

        localStorage.setItem("selectedLanguage", lang);
      }

      // Check the token's expiry
      function checkTokenExpiry() {
        const tokenExpiry = localStorage.getItem("tokenExpiry");
        if (tokenExpiry && Date.now() > Number(tokenExpiry)) {
          console.log("Token expired");
          logoutUser();
          return false;
        }
        return true;
      }

      // Check login status and update UI
      function checkLoginStatus() {
        const authToken = localStorage.getItem("auth_token");
        const loginBtn = document.getElementById("login-btn");
        const signupBtn = document.getElementById("signup-btn");
        const logoutBtn = document.getElementById("logout-btn");
        const dashboardBtn = document.getElementById("dashboard-btn");
        const startNowLi = document.getElementById("start-now-li");

        if (!authToken) {
          // Guest mode
          loginBtn.style.display = "inline-block";
          signupBtn.style.display = "inline-block";
          logoutBtn.classList.add("hidden");
          dashboardBtn.classList.add("hidden");
          startNowLi.classList.add("hidden");
          localStorage.removeItem("isRefreshed");
          return;
        }

        // If token exists, check if it is expired
        if (!checkTokenExpiry()) return;

        const isSubscribed = localStorage.getItem("is_subscribed");
        const isAdmin = localStorage.getItem("isAdmin") === "true";

        // Logged-in mode
        loginBtn.style.display = "none";
        signupBtn.style.display = "none";
        logoutBtn.classList.remove("hidden");

        // Show Dashboard button if admin
        if (isAdmin) {
          dashboardBtn.classList.remove("hidden");
        } else {
          dashboardBtn.classList.add("hidden");
        }

        // Show "Start Now" if the user is subscribed
        if (isSubscribed === "true") {
          startNowLi.classList.remove("hidden");
        } else {
          startNowLi.classList.add("hidden");
        }
      }

      // Logout function
      function logoutUser() {
        // Clear all user-related localStorage keys except language preference
        localStorage.removeItem("auth_token");
        localStorage.removeItem("isAdmin");
        localStorage.removeItem("is_subscribed");
        localStorage.removeItem("tokenExpiry");
        localStorage.removeItem("loggedInUser");
        localStorage.removeItem("isRefreshed");
        // Redirect to the same page
        window.location.href = "download.html";
      }

      document.addEventListener("DOMContentLoaded", () => {
        // Initialize language
        const savedLang = localStorage.getItem("selectedLanguage") || "en";
        updateLanguage(savedLang);

        // Language toggle
        document.getElementById("lang-toggle").addEventListener("click", () => {
          const newLang = document.documentElement.lang === "en" ? "ar" : "en";
          updateLanguage(newLang);
        });

        // Check login status
        checkLoginStatus();

        // Add logout event listener
        document.getElementById("logout-btn").addEventListener("click", (e) => {
          e.preventDefault(); // Prevent default navigation to logout.html
          logoutUser();
        });
      });
    </script>
  </body>
</html>
